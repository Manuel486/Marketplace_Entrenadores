{% extends "base.html" %}
{% load static %}

{% block title %} Gestión de Tipos de Rutina {% endblock title %}

{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}">
{% endblock extra_styles %}

{% block body %}

{% with options=navbar_options %}
    {% include "admin/navbar.html" with options=options %}
{% endwith %}

<main class="main" id="main">
    <div class="content">
        <div class="content__filters">
            <form class="content__search-form" action="" method="get">
                <div class="content__search-wrapper">
                    <span class="iconify content__search-icon" data-icon="mdi:magnify" data-inline="false"></span>
                    <input class="content__search-input" type="text" name="search" placeholder="Buscar por nombre..." value="{{ request.GET.search }}">
                </div>
            </form>
            <a href="{% url 'registrarTipoDeRutina' %}" class="content__create-button">Registrar</a>
        </div>
        <span class="content__total-tipos">Total de tipos de rutina: {{ tipos|length }}</span>
        <div class="table-container">
            <table class="content__table">
                <thead class="content__table-head">
                    <tr class="content__table-row">
                        <th class="content__table-header">#</th>
                        <th class="content__table-header">Nombre</th>
                        <th class="content__table-header">Descripción</th>
                        <th class="content__table-header">Opciones</th>
                    </tr>
                </thead>
                <tbody class="content__table-body">
                    {% for tipo in tipos %}
                    <tr class="content__table-row">
                        <td class="content__table-data">{{ forloop.counter }}</td>
                        <td class="content__table-data">{{ tipo.Nombre }}</td>
                        <td class="content__table-data">{{ tipo.Descripcion }}</td>
                        <td class="content__table-data content__table-data-icons">
                            <a href="{% url 'visualizarTipoDeRutina' tipo.TipoDeRutinaID %}" class="content__view-button">
                                <span class="iconify" data-icon="mdi:eye" data-inline="false"></span>
                            </a>
                            <a href="{% url 'editarTipoDeRutina' tipo.TipoDeRutinaID %}" class="content__edit-button">
                                <span class="iconify" data-icon="mdi:pencil" data-inline="false"></span>
                            </a>
                            <button onclick="confirmarEliminacion({{ tipo.TipoDeRutinaID }})" class="content__delete-button">
                                <span class="iconify" data-icon="mdi:trash-can" data-inline="false"></span>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if mensaje %}
        <p class="content__mensaje">{{ mensaje }}</p>
        {% endif %}
    </div>
</main>

<script src="https://code.iconify.design/2/2.1.2/iconify.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function confirmarEliminacion(tipoId) {
        Swal.fire({
            title: '¿Estás seguro?',
            text: "¡No podrás revertir esto!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sí, eliminar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = "{% url 'eliminarTipoDeRutina' '0' %}".replace('0', tipoId);
            }
        });
    }
</script>
{% endblock %}
